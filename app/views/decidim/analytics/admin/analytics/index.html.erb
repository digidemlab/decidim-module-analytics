<% add_decidim_page_title(t("decidim.analytics.admin.title.analytics")) %>
<style>
.analytics-iframe-container {
  position: relative;
  overflow: hidden;
  border: 1px solid #e6e6e6;
  border-radius: 4px;
  min-height: 600px;
  height: 80vh;
}

.analytics-iframe-container iframe,
.analytics-iframe {
  display: block;
  width: 100%;
  height: 100%;
  border: none;
}
</style>
<div class="row">
  <div class="columns">
    <div class="card" id="analytics">
      <div class="card-divider">
        <h2 class="card-title">
          <%= icon "bar-chart-2-line", class: "icon--before" %>
          <%= t("decidim.analytics.admin.title.analytics") %>
        </h2>
      </div>

      <div class="card-section">
        <% if @server_address.present? && @site_id.present? && @token_auth.present? %>
          <div class="analytics-iframe-container">
            <iframe
              src="<%= matomo_dashboard_url(@server_address, @site_id, @token_auth) %>"
              title="<%= t("decidim.analytics.admin.iframe_title") %>"
              class="analytics-iframe">
            </iframe>
          </div>
        <% else %>
          <div class="callout warning">
            <h5><%= t("decidim.analytics.admin.configuration_missing") %></h5>
            <p><%= t("decidim.analytics.admin.configuration_help") %></p>

            <h6><%= t("decidim.analytics.admin.configuration_instructions") %></h6>
            <pre><code># config/secrets.yml
matomo:
  server_address: "https://your-matomo-domain.com"
  site_id: "1"
  token_auth: "your-token-here"</code></pre>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const iframe = document.querySelector('#analytics iframe');
  if (iframe) {
    setInterval(function() { iframe.src = iframe.src; }, 1800000);
  }
});
</script>